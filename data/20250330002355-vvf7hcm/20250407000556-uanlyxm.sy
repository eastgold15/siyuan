{"ID":"20250407000556-uanlyxm","Spec":"1","Type":"NodeDocument","Properties":{"id":"20250407000556-uanlyxm","title":"Promise.race() 的实战应用场景","type":"doc","updated":"20250510110943"},"Children":[{"ID":"20250510110943-mr0uimx","Type":"NodeThematicBreak","Properties":{"id":"20250510110943-mr0uimx","updated":"20250510110943"}},{"ID":"20250510110943-07q1jwm","Type":"NodeParagraph","Properties":{"id":"20250510110943-07q1jwm","updated":"20250510110943"},"Children":[{"Type":"NodeText","Data":"title: Promise.race() 的实战应用场景\ndate: 2025-04-07T00:05:56Z\nlastmod: 2025-05-10T10:47:58Z"}]},{"ID":"20250510110943-5yhx3gb","Type":"NodeThematicBreak","Properties":{"id":"20250510110943-5yhx3gb","updated":"20250510110943"}},{"ID":"20250510110943-2lk746v","Type":"NodeThematicBreak","Properties":{"id":"20250510110943-2lk746v","updated":"20250510110943"}},{"ID":"20250510110943-acrdnhm","Type":"NodeParagraph","Properties":{"id":"20250510110943-acrdnhm","updated":"20250510110943"},"Children":[{"Type":"NodeText","Data":"title: Promise.race() 的实战应用场景"},{"Type":"NodeBr","Data":"br"},{"Type":"NodeText","Data":"date: 2025-04-07T00:05:56Z"},{"Type":"NodeBr","Data":"br"},{"Type":"NodeText","Data":"lastmod: 2025-04-07T00:07:36Z"}]},{"ID":"20250510110943-vpc57kp","Type":"NodeThematicBreak","Properties":{"id":"20250510110943-vpc57kp","updated":"20250510110943"}},{"ID":"20250510110943-t2o4cm2","Type":"NodeParagraph","Properties":{"id":"20250510110943-t2o4cm2","updated":"20250510110943"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"Promise.race()"},{"Type":"NodeText","Data":"​ 用于 "},{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"多个 Promise 竞争"},{"Type":"NodeText","Data":"，只要其中一个 Promise 完成（无论成功或失败），就立即返回其结果。"}]},{"ID":"20250510110943-hhtagx9","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20250510110943-hhtagx9","updated":"20250510110943"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"Promise.race() 的实战应用场景"}]},{"ID":"20250510110943-pxd129l","Type":"NodeParagraph","Properties":{"id":"20250510110943-pxd129l","updated":"20250510110943"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"Promise.race()"},{"Type":"NodeText","Data":"​ 用于 "},{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"多个 Promise 竞争"},{"Type":"NodeText","Data":"，只要其中一个 Promise 完成（无论成功或失败），就立即返回其结果。以下是它的核心应用场景和代码示例："}]},{"ID":"20250510110943-ikv0xeb","Type":"NodeThematicBreak","Properties":{"id":"20250510110943-ikv0xeb","updated":"20250510110943"}},{"ID":"20250510110943-ziiw170","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20250510110943-ziiw170","updated":"20250510110943"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"1. 网络请求超时控制"}]},{"ID":"20250510110943-o32q3of","Type":"NodeParagraph","Properties":{"id":"20250510110943-o32q3of","updated":"20250510110943"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"场景"},{"Type":"NodeText","Data":"：发起请求时，如果超过指定时间未响应，自动取消并返回超时错误。\n"},{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"代码"},{"Type":"NodeText","Data":"："}]},{"ID":"20250510110943-7takdpt","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20250510110943-7takdpt","updated":"20250510110943"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"amF2YXNjcmlwdA=="},{"Type":"NodeCodeBlockCode","Data":"function fetchWithTimeout(url, timeout = 3000) {\n  const fetchPromise = fetch(url); // 实际请求\n  const timeoutPromise = new Promise((_, reject) =\u003e {\n    setTimeout(() =\u003e reject(new Error(\"Request timeout!\")), timeout);\n  });\n\n  return Promise.race([fetchPromise, timeoutPromise]);\n}\n\n// 使用示例\nfetchWithTimeout(\"https://api.example.com/data\")\n  .then(response =\u003e console.log(\"成功:\", response))\n  .catch(error =\u003e console.log(\"失败:\", error)); // 3秒未响应则触发超时\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20250510110943-3a3vne5","Type":"NodeThematicBreak","Properties":{"id":"20250510110943-3a3vne5","updated":"20250510110943"}},{"ID":"20250510110943-gx311jv","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20250510110943-gx311jv","updated":"20250510110943"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"2. 竞速任务（优先取最快结果）"}]},{"ID":"20250510110943-j3jw5e7","Type":"NodeParagraph","Properties":{"id":"20250510110943-j3jw5e7","updated":"20250510110943"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"场景"},{"Type":"NodeText","Data":"：从多个数据源请求同一资源，取最先返回的结果。\n"},{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"代码"},{"Type":"NodeText","Data":"："}]},{"ID":"20250510110943-mffhmw7","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20250510110943-mffhmw7","updated":"20250510110943"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"amF2YXNjcmlwdA=="},{"Type":"NodeCodeBlockCode","Data":"const source1 = fetch(\"https://source1.example.com/data\");\nconst source2 = fetch(\"https://source2.example.com/data\");\n\nPromise.race([source1, source2])\n  .then(response =\u003e console.log(\"最快结果:\", response))\n  .catch(error =\u003e console.log(\"错误:\", error));\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20250510110943-ifqkc8a","Type":"NodeThematicBreak","Properties":{"id":"20250510110943-ifqkc8a","updated":"20250510110943"}},{"ID":"20250510110943-sinjetq","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20250510110943-sinjetq","updated":"20250510110943"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"3. 长时间任务中断"}]},{"ID":"20250510110943-94o2qm3","Type":"NodeParagraph","Properties":{"id":"20250510110943-94o2qm3","updated":"20250510110943"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"场景"},{"Type":"NodeText","Data":"：用户主动取消长时间运行的任务（如文件上传、计算）。\n"},{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"代码"},{"Type":"NodeText","Data":"："}]},{"ID":"20250510110943-fjdmn8d","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20250510110943-fjdmn8d","updated":"20250510110943"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"amF2YXNjcmlwdA=="},{"Type":"NodeCodeBlockCode","Data":"let cancel;\nconst longTask = new Promise((resolve) =\u003e {\n  const timer = setTimeout(() =\u003e resolve(\"任务完成\"), 5000);\n  cancel = () =\u003e { clearTimeout(timer); reject(\"用户取消\"); };\n});\n\nconst userAction = new Promise((_, reject) =\u003e {\n  // 模拟用户点击取消按钮\n  document.getElementById(\"cancel-btn\").addEventListener(\"click\", () =\u003e reject(\"用户取消\"));\n});\n\nPromise.race([longTask, userAction])\n  .then(result =\u003e console.log(result))\n  .catch(error =\u003e console.log(error)); // 用户点击取消时触发\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20250510110943-6i66rth","Type":"NodeThematicBreak","Properties":{"id":"20250510110943-6i66rth","updated":"20250510110943"}},{"ID":"20250510110943-mpicf1m","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20250510110943-mpicf1m","updated":"20250510110943"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"4. 服务降级（优先主备切换）"}]},{"ID":"20250510110943-e1jnnlx","Type":"NodeParagraph","Properties":{"id":"20250510110943-e1jnnlx","updated":"20250510110943"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"场景"},{"Type":"NodeText","Data":"：主服务不可用时，快速切换到备用服务。\n"},{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"代码"},{"Type":"NodeText","Data":"："}]},{"ID":"20250510110943-3zyf7xi","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20250510110943-3zyf7xi","updated":"20250510110943"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"amF2YXNjcmlwdA=="},{"Type":"NodeCodeBlockCode","Data":"const primaryService = fetch(\"https://primary.example.com\").catch(() =\u003e \"主服务失败\");\nconst backupService = fetch(\"https://backup.example.com\").catch(() =\u003e \"备用服务失败\");\n\nPromise.race([primaryService, backupService])\n  .then(response =\u003e console.log(\"使用服务:\", response));\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20250510110943-wf9grwd","Type":"NodeThematicBreak","Properties":{"id":"20250510110943-wf9grwd","updated":"20250510110943"}},{"ID":"20250510110943-y832ztm","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20250510110943-y832ztm","updated":"20250510110943"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"5. 测试异步代码性能"}]},{"ID":"20250510110943-6t7mlpp","Type":"NodeParagraph","Properties":{"id":"20250510110943-6t7mlpp","updated":"20250510110943"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"场景"},{"Type":"NodeText","Data":"：比较两个异步操作的执行速度。\n"},{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"代码"},{"Type":"NodeText","Data":"："}]},{"ID":"20250510110943-oqvdpny","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20250510110943-oqvdpny","updated":"20250510110943"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"amF2YXNjcmlwdA=="},{"Type":"NodeCodeBlockCode","Data":"const fastTask = new Promise(resolve =\u003e setTimeout(resolve, 100, \"快任务完成\"));\nconst slowTask = new Promise(resolve =\u003e setTimeout(resolve, 200, \"慢任务完成\"));\n\nPromise.race([fastTask, slowTask])\n  .then(result =\u003e console.log(\"胜出:\", result)); // 输出: \"快任务完成\"\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20250510110943-oye68z7","Type":"NodeThematicBreak","Properties":{"id":"20250510110943-oye68z7","updated":"20250510110943"}},{"ID":"20250510110943-j7z1ih3","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20250510110943-j7z1ih3","updated":"20250510110943"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"注意事项"}]},{"ID":"20250510110943-5z89k3f","Type":"NodeList","ListData":{"Typ":1},"Properties":{"id":"20250510110943-5z89k3f","updated":"20250510110943"},"Children":[{"ID":"20250510110943-jg97g41","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"MS4=","Num":1},"Properties":{"id":"20250510110943-jg97g41","updated":"20250510110943"},"Children":[{"ID":"20250510110943-4quii3a","Type":"NodeParagraph","Properties":{"id":"20250510110943-4quii3a","updated":"20250510110943"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"失败不影响其他 Promise"},{"Type":"NodeText","Data":"：即使某个 Promise 被 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"race"},{"Type":"NodeText","Data":"​ 淘汰，它仍会继续执行（除非手动取消）。"}]}]},{"ID":"20250510110943-vjj9p5d","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"Mi4=","Num":2},"Properties":{"id":"20250510110943-vjj9p5d","updated":"20250510110943"},"Children":[{"ID":"20250510110943-dbiw1dj","Type":"NodeParagraph","Properties":{"id":"20250510110943-dbiw1dj","updated":"20250510110943"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"不保证顺序"},{"Type":"NodeText","Data":"：结果取决于哪个 Promise 先完成，与数组中的顺序无关。"}]}]},{"ID":"20250510110943-5gducwb","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"My4=","Num":3},"Properties":{"id":"20250510110943-5gducwb","updated":"20250510110943"},"Children":[{"ID":"20250510110943-21gwy8e","Type":"NodeParagraph","Properties":{"id":"20250510110943-21gwy8e","updated":"20250510110943"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"适用短期竞争"},{"Type":"NodeText","Data":"：适合短期异步操作，长时间任务建议用 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"AbortController"},{"Type":"NodeText","Data":"​。"}]}]}]},{"ID":"20250510110943-m4rryj0","Type":"NodeThematicBreak","Properties":{"id":"20250510110943-m4rryj0","updated":"20250510110943"}},{"ID":"20250510110943-ahn37e4","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20250510110943-ahn37e4","updated":"20250510110943"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"总结"}]},{"ID":"20250510110943-rlqefdp","Type":"NodeList","ListData":{},"Properties":{"id":"20250510110943-rlqefdp","updated":"20250510110943"},"Children":[{"ID":"20250510110943-8d4tt46","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20250510110943-8d4tt46","updated":"20250510110943"},"Children":[{"ID":"20250510110943-a14tzpv","Type":"NodeParagraph","Properties":{"id":"20250510110943-a14tzpv","updated":"20250510110943"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"超时控制"},{"Type":"NodeText","Data":"：强制限制请求等待时间。"}]}]},{"ID":"20250510110943-7nsxsiw","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20250510110943-7nsxsiw","updated":"20250510110943"},"Children":[{"ID":"20250510110943-8bd93ws","Type":"NodeParagraph","Properties":{"id":"20250510110943-8bd93ws","updated":"20250510110943"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"竞速任务"},{"Type":"NodeText","Data":"：取最快响应的数据源。"}]}]},{"ID":"20250510110943-n4c6wf9","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20250510110943-n4c6wf9","updated":"20250510110943"},"Children":[{"ID":"20250510110943-98fkt2m","Type":"NodeParagraph","Properties":{"id":"20250510110943-98fkt2m","updated":"20250510110943"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"用户中断"},{"Type":"NodeText","Data":"：允许用户取消长时间操作。"}]}]},{"ID":"20250510110943-uv3vo18","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20250510110943-uv3vo18","updated":"20250510110943"},"Children":[{"ID":"20250510110943-k587w44","Type":"NodeParagraph","Properties":{"id":"20250510110943-k587w44","updated":"20250510110943"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"服务降级"},{"Type":"NodeText","Data":"：主备服务快速切换。"}]}]},{"ID":"20250510110943-5bkf92d","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20250510110943-5bkf92d","updated":"20250510110943"},"Children":[{"ID":"20250510110943-nce8el0","Type":"NodeParagraph","Properties":{"id":"20250510110943-nce8el0","updated":"20250510110943"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"性能测试"},{"Type":"NodeText","Data":"：比较异步任务速度。"}]}]}]},{"ID":"20250510110943-v102m8d","Type":"NodeParagraph","Properties":{"id":"20250510110943-v102m8d","updated":"20250510110943"},"Children":[{"Type":"NodeText","Data":" 🚀"}]},{"ID":"20250510110943-hj2y0ri","Type":"NodeParagraph","Properties":{"id":"20250510110943-hj2y0ri","updated":"20250510110943"},"Children":[{"Type":"NodeText","Data":"‍"}]}]}