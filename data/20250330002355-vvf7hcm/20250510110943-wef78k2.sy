{"ID":"20250510110943-wef78k2","Spec":"1","Type":"NodeDocument","Properties":{"id":"20250510110943-wef78k2","title":"Promise.race() 的实战应用场景_conflict_github_1746846583068","type":"doc","updated":"20250510110943"},"Children":[{"ID":"20250510110938-07ei7r3","Type":"NodeThematicBreak","Properties":{"id":"20250510110938-07ei7r3","updated":"20250510110938"}},{"ID":"20250510110938-utg0urs","Type":"NodeParagraph","Properties":{"id":"20250510110938-utg0urs","updated":"20250510110938"},"Children":[{"Type":"NodeText","Data":"title: Promise.race() 的实战应用场景\ndate: 2025-04-07T00:05:56Z\nlastmod: 2025-04-07T00:07:36Z"}]},{"ID":"20250510110938-w4c34tx","Type":"NodeThematicBreak","Properties":{"id":"20250510110938-w4c34tx","updated":"20250510110938"}},{"ID":"20250510110938-ryv18uq","Type":"NodeParagraph","Properties":{"id":"20250510110938-ryv18uq","updated":"20250510110938"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"Promise.race()"},{"Type":"NodeText","Data":"​ 用于 "},{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"多个 Promise 竞争"},{"Type":"NodeText","Data":"，只要其中一个 Promise 完成（无论成功或失败），就立即返回其结果。"}]},{"ID":"20250510110938-hb1ndf7","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20250510110938-hb1ndf7","updated":"20250510110938"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"Promise.race() 的实战应用场景"}]},{"ID":"20250510110938-ornulse","Type":"NodeParagraph","Properties":{"id":"20250510110938-ornulse","updated":"20250510110938"},"Children":[{"Type":"NodeText","Data":"​"},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"Promise.race()"},{"Type":"NodeText","Data":"​ 用于 "},{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"多个 Promise 竞争"},{"Type":"NodeText","Data":"，只要其中一个 Promise 完成（无论成功或失败），就立即返回其结果。以下是它的核心应用场景和代码示例："}]},{"ID":"20250510110938-2j0piy3","Type":"NodeThematicBreak","Properties":{"id":"20250510110938-2j0piy3","updated":"20250510110938"}},{"ID":"20250510110938-mc99gg0","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20250510110938-mc99gg0","updated":"20250510110938"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"1. 网络请求超时控制"}]},{"ID":"20250510110938-bgojl8k","Type":"NodeParagraph","Properties":{"id":"20250510110938-bgojl8k","updated":"20250510110938"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"场景"},{"Type":"NodeText","Data":"：发起请求时，如果超过指定时间未响应，自动取消并返回超时错误。"},{"Type":"NodeBr","Data":"br"},{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"代码"},{"Type":"NodeText","Data":"："}]},{"ID":"20250510110938-d6089aw","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20250510110938-d6089aw","updated":"20250510110938"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"amF2YXNjcmlwdA=="},{"Type":"NodeCodeBlockCode","Data":"function fetchWithTimeout(url, timeout = 3000) {\n  const fetchPromise = fetch(url); // 实际请求\n  const timeoutPromise = new Promise((_, reject) =\u003e {\n    setTimeout(() =\u003e reject(new Error(\"Request timeout!\")), timeout);\n  });\n\n  return Promise.race([fetchPromise, timeoutPromise]);\n}\n\n// 使用示例\nfetchWithTimeout(\"https://api.example.com/data\")\n  .then(response =\u003e console.log(\"成功:\", response))\n  .catch(error =\u003e console.log(\"失败:\", error)); // 3秒未响应则触发超时\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20250510110938-vgu8w7u","Type":"NodeThematicBreak","Properties":{"id":"20250510110938-vgu8w7u","updated":"20250510110938"}},{"ID":"20250510110938-t4jkm6t","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20250510110938-t4jkm6t","updated":"20250510110938"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"2. 竞速任务（优先取最快结果）"}]},{"ID":"20250510110938-q1xdig6","Type":"NodeParagraph","Properties":{"id":"20250510110938-q1xdig6","updated":"20250510110938"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"场景"},{"Type":"NodeText","Data":"：从多个数据源请求同一资源，取最先返回的结果。"},{"Type":"NodeBr","Data":"br"},{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"代码"},{"Type":"NodeText","Data":"："}]},{"ID":"20250510110938-1m5dto5","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20250510110938-1m5dto5","updated":"20250510110938"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"amF2YXNjcmlwdA=="},{"Type":"NodeCodeBlockCode","Data":"const source1 = fetch(\"https://source1.example.com/data\");\nconst source2 = fetch(\"https://source2.example.com/data\");\n\nPromise.race([source1, source2])\n  .then(response =\u003e console.log(\"最快结果:\", response))\n  .catch(error =\u003e console.log(\"错误:\", error));\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20250510110938-7ltpa8s","Type":"NodeThematicBreak","Properties":{"id":"20250510110938-7ltpa8s","updated":"20250510110938"}},{"ID":"20250510110938-hvp8m1a","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20250510110938-hvp8m1a","updated":"20250510110938"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"3. 长时间任务中断"}]},{"ID":"20250510110938-47w26ia","Type":"NodeParagraph","Properties":{"id":"20250510110938-47w26ia","updated":"20250510110938"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"场景"},{"Type":"NodeText","Data":"：用户主动取消长时间运行的任务（如文件上传、计算）。"},{"Type":"NodeBr","Data":"br"},{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"代码"},{"Type":"NodeText","Data":"："}]},{"ID":"20250510110938-g99s7qa","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20250510110938-g99s7qa","updated":"20250510110938"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"amF2YXNjcmlwdA=="},{"Type":"NodeCodeBlockCode","Data":"let cancel;\nconst longTask = new Promise((resolve) =\u003e {\n  const timer = setTimeout(() =\u003e resolve(\"任务完成\"), 5000);\n  cancel = () =\u003e { clearTimeout(timer); reject(\"用户取消\"); };\n});\n\nconst userAction = new Promise((_, reject) =\u003e {\n  // 模拟用户点击取消按钮\n  document.getElementById(\"cancel-btn\").addEventListener(\"click\", () =\u003e reject(\"用户取消\"));\n});\n\nPromise.race([longTask, userAction])\n  .then(result =\u003e console.log(result))\n  .catch(error =\u003e console.log(error)); // 用户点击取消时触发\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20250510110938-fl9k5xj","Type":"NodeThematicBreak","Properties":{"id":"20250510110938-fl9k5xj","updated":"20250510110938"}},{"ID":"20250510110938-gjbn8ab","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20250510110938-gjbn8ab","updated":"20250510110938"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"4. 服务降级（优先主备切换）"}]},{"ID":"20250510110938-yh3btmc","Type":"NodeParagraph","Properties":{"id":"20250510110938-yh3btmc","updated":"20250510110938"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"场景"},{"Type":"NodeText","Data":"：主服务不可用时，快速切换到备用服务。"},{"Type":"NodeBr","Data":"br"},{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"代码"},{"Type":"NodeText","Data":"："}]},{"ID":"20250510110938-3m60etg","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20250510110938-3m60etg","updated":"20250510110938"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"amF2YXNjcmlwdA=="},{"Type":"NodeCodeBlockCode","Data":"const primaryService = fetch(\"https://primary.example.com\").catch(() =\u003e \"主服务失败\");\nconst backupService = fetch(\"https://backup.example.com\").catch(() =\u003e \"备用服务失败\");\n\nPromise.race([primaryService, backupService])\n  .then(response =\u003e console.log(\"使用服务:\", response));\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20250510110938-nahwak5","Type":"NodeThematicBreak","Properties":{"id":"20250510110938-nahwak5","updated":"20250510110938"}},{"ID":"20250510110938-23zft4r","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20250510110938-23zft4r","updated":"20250510110938"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"5. 测试异步代码性能"}]},{"ID":"20250510110938-jc8j40y","Type":"NodeParagraph","Properties":{"id":"20250510110938-jc8j40y","updated":"20250510110938"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"场景"},{"Type":"NodeText","Data":"：比较两个异步操作的执行速度。"},{"Type":"NodeBr","Data":"br"},{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"代码"},{"Type":"NodeText","Data":"："}]},{"ID":"20250510110938-4x9mam6","Type":"NodeCodeBlock","IsFencedCodeBlock":true,"Properties":{"id":"20250510110938-4x9mam6","updated":"20250510110938"},"Children":[{"Type":"NodeCodeBlockFenceOpenMarker","Data":"```"},{"Type":"NodeCodeBlockFenceInfoMarker","CodeBlockInfo":"amF2YXNjcmlwdA=="},{"Type":"NodeCodeBlockCode","Data":"const fastTask = new Promise(resolve =\u003e setTimeout(resolve, 100, \"快任务完成\"));\nconst slowTask = new Promise(resolve =\u003e setTimeout(resolve, 200, \"慢任务完成\"));\n\nPromise.race([fastTask, slowTask])\n  .then(result =\u003e console.log(\"胜出:\", result)); // 输出: \"快任务完成\"\n"},{"Type":"NodeCodeBlockFenceCloseMarker","Data":"```"}]},{"ID":"20250510110938-puzopgd","Type":"NodeThematicBreak","Properties":{"id":"20250510110938-puzopgd","updated":"20250510110938"}},{"ID":"20250510110938-y0ji4zw","Type":"NodeHeading","HeadingLevel":2,"Properties":{"id":"20250510110938-y0ji4zw","updated":"20250510110938"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"注意事项"}]},{"ID":"20250510110938-vs2cca7","Type":"NodeList","ListData":{"Typ":1},"Properties":{"id":"20250510110938-vs2cca7","updated":"20250510110938"},"Children":[{"ID":"20250510110938-8jk74kz","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"MS4=","Num":1},"Properties":{"id":"20250510110938-8jk74kz","updated":"20250510110938"},"Children":[{"ID":"20250510110938-jonrey2","Type":"NodeParagraph","Properties":{"id":"20250510110938-jonrey2","updated":"20250510110938"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"失败不影响其他 Promise"},{"Type":"NodeText","Data":"：即使某个 Promise 被 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"race"},{"Type":"NodeText","Data":"​ 淘汰，它仍会继续执行（除非手动取消）。"}]}]},{"ID":"20250510110938-j2y4oe8","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"Mi4=","Num":2},"Properties":{"id":"20250510110938-j2y4oe8","updated":"20250510110938"},"Children":[{"ID":"20250510110938-vny99q8","Type":"NodeParagraph","Properties":{"id":"20250510110938-vny99q8","updated":"20250510110938"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"不保证顺序"},{"Type":"NodeText","Data":"：结果取决于哪个 Promise 先完成，与数组中的顺序无关。"}]}]},{"ID":"20250510110938-cz16vay","Type":"NodeListItem","ListData":{"Typ":1,"Delimiter":46,"Marker":"My4=","Num":3},"Properties":{"id":"20250510110938-cz16vay","updated":"20250510110938"},"Children":[{"ID":"20250510110938-h85wgs7","Type":"NodeParagraph","Properties":{"id":"20250510110938-h85wgs7","updated":"20250510110938"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"适用短期竞争"},{"Type":"NodeText","Data":"：适合短期异步操作，长时间任务建议用 "},{"Type":"NodeTextMark","TextMarkType":"code","TextMarkTextContent":"AbortController"},{"Type":"NodeText","Data":"​。"}]}]}]},{"ID":"20250510110938-bjmc62r","Type":"NodeThematicBreak","Properties":{"id":"20250510110938-bjmc62r","updated":"20250510110938"}},{"ID":"20250510110938-1naphgy","Type":"NodeHeading","HeadingLevel":3,"Properties":{"id":"20250510110938-1naphgy","updated":"20250510110938"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"总结"}]},{"ID":"20250510110938-oizzsfv","Type":"NodeList","ListData":{},"Properties":{"id":"20250510110938-oizzsfv","updated":"20250510110938"},"Children":[{"ID":"20250510110938-dl6wrne","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20250510110938-dl6wrne","updated":"20250510110938"},"Children":[{"ID":"20250510110938-3zyp6hr","Type":"NodeParagraph","Properties":{"id":"20250510110938-3zyp6hr","updated":"20250510110938"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"超时控制"},{"Type":"NodeText","Data":"：强制限制请求等待时间。"}]}]},{"ID":"20250510110938-17tefkz","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20250510110938-17tefkz","updated":"20250510110938"},"Children":[{"ID":"20250510110938-ztvdayo","Type":"NodeParagraph","Properties":{"id":"20250510110938-ztvdayo","updated":"20250510110938"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"竞速任务"},{"Type":"NodeText","Data":"：取最快响应的数据源。"}]}]},{"ID":"20250510110938-cya057o","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20250510110938-cya057o","updated":"20250510110938"},"Children":[{"ID":"20250510110938-mwln4jl","Type":"NodeParagraph","Properties":{"id":"20250510110938-mwln4jl","updated":"20250510110938"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"用户中断"},{"Type":"NodeText","Data":"：允许用户取消长时间操作。"}]}]},{"ID":"20250510110938-sbnnqa7","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20250510110938-sbnnqa7","updated":"20250510110938"},"Children":[{"ID":"20250510110938-hiy1zuz","Type":"NodeParagraph","Properties":{"id":"20250510110938-hiy1zuz","updated":"20250510110938"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"服务降级"},{"Type":"NodeText","Data":"：主备服务快速切换。"}]}]},{"ID":"20250510110938-bh3h9xo","Type":"NodeListItem","ListData":{"BulletChar":42,"Marker":"Kg=="},"Properties":{"id":"20250510110938-bh3h9xo","updated":"20250510110938"},"Children":[{"ID":"20250510110938-3oj7aml","Type":"NodeParagraph","Properties":{"id":"20250510110938-3oj7aml","updated":"20250510110938"},"Children":[{"Type":"NodeTextMark","TextMarkType":"strong","TextMarkTextContent":"性能测试"},{"Type":"NodeText","Data":"：比较异步任务速度。"}]}]}]},{"ID":"20250510110938-icoj38i","Type":"NodeParagraph","Properties":{"id":"20250510110938-icoj38i","updated":"20250510110938"},"Children":[{"Type":"NodeText","Data":" 🚀"}]},{"ID":"20250510110938-jhdja2m","Type":"NodeParagraph","Properties":{"id":"20250510110938-jhdja2m","updated":"20250510110938"},"Children":[{"Type":"NodeText","Data":"‍"}]}]}